// @bun
var c=(a)=>{return typeof a==="object"&&typeof a.access_token==="string"&&(typeof a.refresh_token==="undefined"||typeof a.refresh_token==="string")&&typeof a.token_type==="string"&&(typeof a.expires_in==="undefined"||typeof a.expires_in==="number")&&(typeof a.scope==="undefined"||typeof a.scope==="string")&&(typeof a.id_token==="undefined"||typeof a.id_token==="string")};async function U(a){let t=new TextEncoder().encode(a),o=await crypto.subtle.digest("SHA-256",t);return P(o)}function P(a){let t=a instanceof Uint8Array?a:new Uint8Array(a),o="";for(let n of t)o+=String.fromCharCode(n);return(typeof btoa==="function"?btoa(o):typeof Buffer!=="undefined"?Buffer.from(t).toString("base64"):(()=>{throw new Error("No Base64 encoder available")})()).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function k(a,t){let o=new TextEncoder().encode(t.toString()),i=new Request(a,{method:"POST",body:o});return i.headers.set("Content-Type","application/x-www-form-urlencoded"),i.headers.set("Accept","application/json"),i.headers.set("User-Agent","citra"),i.headers.set("Content-Length",String(o.byteLength)),i}async function m(a){let t;try{t=await fetch(a)}catch(o){if(o instanceof Error)throw new Error(`${o.message} - ${o.stack??""}`);throw new Error(`Unexpected error: ${o}`)}if(t.status===400||t.status===401){let o;try{o=await t.json()}catch(i){if(i instanceof Error)throw new Error(`${i.message} - ${i.stack??""}`);throw new Error(`Unexpected error: ${i}`)}if(typeof o!=="object"||o===null)throw new z(t.status,o);throw _(o)}if(t.status===200){let o;try{o=await t.json()}catch(i){if(i instanceof Error)throw new Error(`${i.message} - ${i.stack??""}`);throw new Error(`Unexpected error: ${i}`)}if(!c(o)||o===null)throw new z(t.status,o);return o}if(t.body)await t.body.cancel();throw new Error(`Unexpected response status: ${t.status} - ${t.statusText}`)}async function C(a){let t;try{t=await fetch(a)}catch(o){if(o instanceof Error)throw new Error(`${o.message} - ${o.stack??""}`);throw new Error(`Unexpected error: ${o}`)}if(t.status===400||t.status===401){let o;try{o=await t.json()}catch{throw new z(t.status,null)}if(typeof o!=="object"||o===null)throw new z(t.status,o);throw _(o)}if(t.status===200){if(t.body)await t.body.cancel();return}if(t.body)await t.body.cancel();throw new Error(`Failed to revoke tokens: ${t.status} - ${t.statusText}`)}function _(a){if(typeof a.error!=="string")throw new Error("Invalid error response");let t=a.error,o=typeof a.error_description==="string"?a.error_description:null,i=typeof a.error_uri==="string"?a.error_uri:null,n=typeof a.state==="string"?a.state:null;return new f(t,o,i,n)}class f extends Error{code;description;uri;state;constructor(a,t,o,i){super(`OAuth request error: ${a}`);this.code=a,this.description=t,this.uri=o,this.state=i}}class z extends Error{status;data;constructor(a,t){super("Unexpected error response body");this.status=a,this.data=t}}function K(a){return a}var v=K({"42":{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://api.intra.42.fr/oauth/authorize",tokenUrl:"https://api.intra.42.fr/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},AmazonCognito:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://${domain}/oauth2/authorize",tokenUrl:"https://${domain}/oauth2/token",tokenRevocationUrl:"https://${domain}/oauth2/revoke"},AniList:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://anilist.co/api/v2/oauth/authorize",tokenUrl:"https://anilist.co/api/v2/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Apple:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://appleid.apple.com/auth/authorize",tokenUrl:"https://appleid.apple.com/auth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Auth0:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://${domain}/authorize",tokenUrl:"https://${domain}/oauth/token",tokenRevocationUrl:"https://${domain}/oauth/revoke",refreshAccessTokenBody:{grant_type:"refresh_token"},tokenRevocationBody:{token_type_hint:"refresh_token"}},Authentik:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://${baseURL}/oauth/authorize",tokenUrl:"https://${baseURL}/oauth/token"},Autodesk:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://developer.api.autodesk.com/authentication/v1/authorize",tokenUrl:"https://developer.api.autodesk.com/authentication/v1/gettoken",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Atlassian:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://auth.atlassian.com/authorize",tokenUrl:"https://auth.atlassian.com/oauth/token",tokenRevocationUrl:"https://auth.atlassian.com/oauth/revoke",createAuthorizationURLSearchParams:{audience:"api.atlassian.com",prompt:"consent"},validateAuthorizationCodeBody:{grant_type:"authorization_code"},refreshAccessTokenBody:{grant_type:"refresh_token"}},Battlenet:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://oauth.battle.net/authorize",tokenUrl:"https://oauth.battle.net/token",createAuthorizationURLSearchParams:{response_type:"code",scope:"openid"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Bitbucket:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://bitbucket.org/site/oauth2/authorize",tokenUrl:"https://bitbucket.org/site/oauth2/access_token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Box:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://account.box.com/api/oauth2/authorize",tokenUrl:"https://api.box.com/oauth2/token",validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Bungie:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.bungie.net/en/OAuth/Authorize",tokenUrl:"https://www.bungie.net/platform/app/oauth/token/"},Coinbase:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.coinbase.com/oauth/authorize",tokenUrl:"https://api.coinbase.com/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Discord:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://discord.com/api/oauth2/authorize",tokenUrl:"https://discord.com/api/oauth2/token"},DonationAlerts:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.donationalerts.com/oauth/authorize",tokenUrl:"https://www.donationalerts.com/oauth/token"},Dribbble:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://dribbble.com/oauth/authorize",tokenUrl:"https://dribbble.com/oauth/token"},Dropbox:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.dropbox.com/oauth2/authorize",tokenUrl:"https://api.dropboxapi.com/oauth2/token"},EpicGames:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.epicgames.com/id/authorize",tokenUrl:"https://api.epicgames.dev/epic/oauth/v1/token"},Etsy:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.etsy.com/oauth/connect",tokenUrl:"https://api.etsy.com/v3/public/oauth/token"},Facebook:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.facebook.com/v16.0/dialog/oauth",tokenUrl:"https://graph.facebook.com/v16.0/oauth/access_token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Figma:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.figma.com/oauth",tokenUrl:"https://api.figma.com/v1/oauth/token"},Gitea:{isPKCE:!0,isOIDC:!1,authorizationUrl:"${baseURL}/login/oauth/authorize",tokenUrl:"${baseURL}/login/oauth/access_token"},GitHub:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},GitLab:{isPKCE:!0,isOIDC:!1,authorizationUrl:"${baseURL}/oauth/authorize",tokenUrl:"${baseURL}/oauth/token",tokenRevocationUrl:"${baseURL}/oauth/revoke"},Google:{isPKCE:!0,isOIDC:!0,requiresScope:!0,authorizationUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",tokenRevocationUrl:"https://oauth2.googleapis.com/revoke",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Intuit:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://appcenter.intuit.com/connect/oauth2",tokenUrl:"https://oauth.platform.intuit.com/oauth2/v1/tokens/bearer",tokenRevocationUrl:"https://developer.API.intuit.com/v2/oauth2/tokens/revoke"},Kakao:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://kauth.kakao.com/oauth/authorize",tokenUrl:"https://kauth.kakao.com/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},KeyCloak:{isPKCE:!0,isOIDC:!0,authorizationUrl:"${realmURL}/protocol/openid-connect/auth",tokenUrl:"${realmURL}/protocol/openid-connect/token",tokenRevocationUrl:"${realmURL}/protocol/openid-connect/revoke"},Kick:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://id.kick.com/oauth/authorize",tokenUrl:"https://id.kick.com/oauth/token",tokenRevocationUrl:"https://id.kick.com/oauth/revoke",createAuthorizationURLSearchParams:{response_type:"code",code_challenge_method:"S256"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Line:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://access.line.me/oauth2/v2.1/authorize",tokenUrl:"https://api.line.me/oauth2/v2.1/token",createAuthorizationURLSearchParams:{response_type:"code",code_challenge_method:"S256"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Lichess:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://lichess.org/oauth",tokenUrl:"https://lichess.org/api/token"},LinkedIn:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.linkedin.com/oauth/v2/authorization",tokenUrl:"https://www.linkedin.com/oauth/v2/accessToken",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Linear:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://linear.app/oauth/authorize",tokenUrl:"https://api.linear.app/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Mastodon:{isPKCE:!0,isOIDC:!1,authorizationUrl:"${baseURL}/api/v1/oauth/authorize",tokenUrl:"${baseURL}/api/v1/oauth/token",tokenRevocationUrl:"${baseURL}/api/v1/oauth/revoke"},MercadoLibre:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://auth.mercadolibre.com/authorization",tokenUrl:"https://api.mercadolibre.com/oauth/token"},MercadoPago:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://auth.mercadopago.com/authorization",tokenUrl:"https://api.mercadopago.com/oauth/token"},MicrosoftEntraId:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://${tenantId}.b2clogin.com/${tenantId}/oauth2/v2.0/authorize",tokenUrl:"https://${tenantId}.b2clogin.com/${tenantId}/oauth2/v2.0/token"},MyAnimeList:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://myanimelist.net/v1/oauth2/authorize",tokenUrl:"https://myanimelist.net/v1/oauth2/token"},Naver:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://nid.naver.com/oauth2.0/authorize",tokenUrl:"https://nid.naver.com/oauth2.0/token"},Notion:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://api.notion.com/v1/oauth/authorize",tokenUrl:"https://api.notion.com/v1/oauth/token"},Okta:{isPKCE:!0,isOIDC:!0,authorizationUrl:"https://${domain}/oauth2/default/v1/authorize",tokenUrl:"https://${domain}/oauth2/default/v1/token",tokenRevocationUrl:"https://${domain}/oauth2/default/v1/revoke"},Osu:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://osu.ppy.sh/oauth/authorize",tokenUrl:"https://osu.ppy.sh/oauth/token"},Patreon:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.patreon.com/oauth2/authorize",tokenUrl:"https://www.patreon.com/api/oauth2/token"},Polar:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://flow.polar.com/oauth2/authorization",tokenUrl:"https://polarremote.com/oauth2/token"},Reddit:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.reddit.com/api/v1/authorize",tokenUrl:"https://www.reddit.com/api/v1/access_token"},Roblox:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.roblox.com/oauth/authorize",tokenUrl:"https://oauth.roblox.com/v1/token"},Salesforce:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://login.salesforce.com/services/oauth2/authorize",tokenUrl:"https://login.salesforce.com/services/oauth2/token"},Shikimori:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://shikimori.org/oauth/authorize",tokenUrl:"https://shikimori.org/oauth/token"},Slack:{isPKCE:!1,isOIDC:!0,authorizationUrl:"https://slack.com/openid/connect/authorize",tokenUrl:"https://slack.com/api/openid.connect.token"},Spotify:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://accounts.spotify.com/authorize",tokenUrl:"https://accounts.spotify.com/api/token"},StartGG:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://start.gg/oauth/authoriz",tokenUrl:"https://api.start.gg/oauth/access_token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Strava:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.strava.com/oauth/authorize",tokenUrl:"https://www.strava.com/api/v3/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Synology:{isPKCE:!0,isOIDC:!1,authorizationUrl:"${baseURL}/webman/sso/SSOOauth.cgi",tokenUrl:"${baseURL}/webman/sso/SSOAccessToken.cgi"},TikTok:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://www.tiktok.com/v2/auth/authorize",tokenUrl:"https://open.tiktokapis.com/v2/oauth/token/",tokenRevocationUrl:"https://open.tiktokapis.com/v2/oauth/revoke/",createAuthorizationURLSearchParams:{response_type:"code",code_challenge_method:"S256"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Tiltify:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://v5api.tiltify.com/oauth/authorizeze",tokenUrl:"https://v5api.tiltify.com/oauth/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Tumblr:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://www.tumblr.com/oauth2/authorize",tokenUrl:"https://api.tumblr.com/v2/oauth2/token"},Twitch:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://id.twitch.tv/oauth2/authorize",tokenUrl:"https://id.twitch.tv/oauth2/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Twitter:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://twitter.com/i/oauth2/authorize",tokenUrl:"https://api.twitter.com/2/oauth2/token",createAuthorizationURLSearchParams:{response_type:"code",code_challenge_method:"S256"},validateAuthorizationCodeBody:{grant_type:"authorization_code"},refreshAccessTokenBody:{grant_type:"refresh_token"}},VK:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://oauth.vk.com/authorize",tokenUrl:"https://oauth.vk.com/access_token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},WorkOS:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://api.workos.com/sso/authorize",tokenUrl:"https://api.workos.com/sso/token",createAuthorizationURLSearchParams:{response_type:"code",code_challenge_method:"S256"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Yahoo:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://api.login.yahoo.com/oauth2/request_auth",tokenUrl:"https://api.login.yahoo.com/oauth2/get_token"},Yandex:{isPKCE:!1,isOIDC:!1,authorizationUrl:"https://oauth.yandex.com/authorize",tokenUrl:"https://oauth.yandex.com/token",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"}},Zoom:{isPKCE:!0,isOIDC:!1,authorizationUrl:"https://zoom.us/oauth/authorize",tokenUrl:"https://zoom.us/oauth/token",tokenRevocationUrl:"https://zoom.us/oauth/revoke",createAuthorizationURLSearchParams:{response_type:"code"},validateAuthorizationCodeBody:{grant_type:"authorization_code"},refreshAccessTokenBody:{grant_type:"refresh_token"}}});function E(a,t){let o=v[a],i=async(n,h)=>{let e=k(n,h);return m(e)};return{async createAuthorizationUrl(n){let{state:h,scope:e=[],extraParams:s={},codeVerifier:u}=n||{},r=new URL(o.authorizationUrl);if(r.searchParams.set("response_type","code"),r.searchParams.set("client_id",t.clientId),t.redirectUri)r.searchParams.set("redirect_uri",t.redirectUri);if(h)r.searchParams.set("state",h);if(e.length)r.searchParams.set("scope",e.join(" "));if(o.isPKCE){let p=u;r.searchParams.set("code_challenge_method","S256");let l=await U(p);r.searchParams.set("code_challenge",l)}return Object.entries(o.createAuthorizationURLSearchParams||{}).forEach(([p,l])=>r.searchParams.set(p,l)),Object.entries(s).forEach(([p,l])=>r.searchParams.set(p,l)),r},validateAuthorizationCode(n,{codeVerifier:h}={}){let e=new URLSearchParams;if(e.set("grant_type","authorization_code"),e.set("code",n),t.redirectUri)e.set("redirect_uri",t.redirectUri);if(Object.entries(o.validateAuthorizationCodeBody||{}).forEach(([s,u])=>e.set(s,u)),"clientSecret"in t&&t.clientSecret)e.set("client_id",t.clientId),e.set("client_secret",t.clientSecret);else e.set("client_id",t.clientId);return i(o.tokenUrl,e)},refresh(n){if(!o.refreshAccessTokenBody)return Promise.reject(new Error("Refresh not supported"));let h=new URLSearchParams;if(h.set("grant_type","refresh_token"),h.set("refresh_token",n),Object.entries(o.refreshAccessTokenBody).forEach(([e,s])=>h.set(e,s)),"clientSecret"in t&&t.clientSecret)h.set("client_id",t.clientId),h.set("client_secret",t.clientSecret);return i(o.tokenUrl,h)},revoke(n){if(!o.tokenRevocationUrl)return Promise.reject(new Error("Revocation not supported"));let h=new URLSearchParams;if(h.set("token",n),Object.entries(o.tokenRevocationBody||{}).forEach(([s,u])=>h.set(s,u)),h.set("client_id",t.clientId),"clientSecret"in t&&t.clientSecret)h.set("client_secret",t.clientSecret);let e=k(o.tokenRevocationUrl,h);return C(e)}}}export{E as createOAuth2Client};
